<template>
  <div class="top">
    <div class="container">
      <div class="tool">
        <div class="logo left">
          <a href="#/banner" class=""></a>
        </div>
        <div class="versions left">
          <Select
            v-model="model1"
            placeholder="Select projectSpace"
            class="selectWidth"
            ref='headerBarSelect'
            @on-change="selectChange($event)"
          >
            <Option v-for="item in projectSpace" :value="item.value" :key="item">{{ item.label }}</Option>
          </Select>
        </div>
        <div class="useFor left">
          <div class="title">
          <span class="title-logo"  @click="toggle()">
            <span class="fa fa-table logo common left"></span>
            <span class="common text left">{{currentStatus}}</span>
          </span>
            <ul class="status-list" v-show="show">
              <li
                v-for="(current,index) in status"
                :current="currentStatus"
                @click="select(index,$event)"
                :class="{currentStyle:statusIndex == index}"
              >
              <router-link :to="current.listto" :id="current.list"> {{current.list}} </router-link>
              </li>
            </ul>
          </div>
        </div>
        <div class="tool-right right">
          <div class="search-bar left">
            <span class="search"></span>
            <input type="text" name="search">
          </div>
          <div class="set left">
            <span class="bell set-common left"></span>
            <span class="tj set-common left">Tj</span>
          </div>
        </div>
      </div>
      <!-- <div class="nav">
        <ul class="nav-list" id="nav-list">
          <li>
            <router-link to="/boards">Boards</router-link>
          </li>
          <li>
            <router-link to="/list">List</router-link>
          </li>
          <div class="clearfix"></div>
        </ul>
      </div> -->
    </div>
  </div>
</template>
<script>
    import store from '../../../vuex/store.js';
    export default {
      created() {
         var proId = sessionStorage.getItem("proId");
         var subId = sessionStorage.getItem("subId");
         this.getSelect(proId,subId);
      },
      props: ['current'],
      data:function(){
        return {
          status:[
            {list:'Home', listto:'/homepage/Home', isClick: true},
            {list:'Management', listto:'/homepage/management', isClick: true},
            {list:'Requirement', listto:'/homepage/Requirement', isClick: true},
            {list:'Development', listto:'/homepage/development/boards', isClick: true},
            // {list:'Test Library', listto:'/homepage/testLibrary', isClick: true},
            // {list:'Test Run', listto:'/homepage/testRun', isClick: true},
            {list:'Test', listto:'/homepage/test', isClick: true},
            {list:'Members', listto:'/homepage/members', isClick: true},
            {list:'Administrator', listto:'/homepage/administrator', isClick: true}
          ],
          show: false,
          currentStatus: 'Management',
          statusIndex: '',
          projectSpace: [],
          projectId: '',
          subProjectId: '',
          selectContentSpace:'',
          flag: true
        }
      },
      computed: {
        isClick: function(){
            return false;
        },
        model1: function(){
         return this.$store.state.selectContent;
       }
      },
      methods: {
          toggle(){
            this.show = !this.show;
          },
          select(i,e){
            this.currentStatus = e.target.innerText;
            this.show = !this.show;
            this.statusIndex=i;
          },
          selectChange(e) {
            var list = this.projectSpace;
            // console.log(list[0].value)
            for(var i=0;i<list.length;i++) {
              if(list[i].value == e) {
                var subId =this.selectContentSpace[i].subprojectId;
                var proId =this.selectContentSpace[i].projectId;
                if(this.flag) {
                  this.flag = false;
                }else {
                  this.flag = true;
                }
                this.selectChangeIds(proId,subId,this.flag);
                this.addContent(e);
              }
            }
          },
          getSelect(proId,subId){
            var content = this.model1;
            if( content !== '') {
              this.model1 = content;
            }else {
              this.model1 = sessionStorage.getItem("selectcontent");
            }
            const SELECT_URL = DevTrackApi + '/SubProject/GetTree';
            this.$http.post(SELECT_URL,{
              token: APIToken,
              projectId: proId,
              subprojectId: 0,
            }).then(res=>{
              this.selectContentSpace = res.body.nodes;
              var  spaces = res.body.nodes;
              for(var i=0;i<spaces.length;i++) {
                 this.projectSpace.push({value:spaces[i].subprojectName,label:spaces[i].subprojectName})
              }
            },err=>{
              console.log(err);
            })
          },
          selectChangeIds(proId,subId,flag){
            this.$store.commit({
              type: 'changeIds',
              projectId: proId,
              subProjectId: subId,
              tempFlag: flag
            })
          },
          addContent(content) {
            this.$store.commit({
              type: 'changeContent',
              selectContent: content
            })
          },
          ClickProjectSpace(status) {
            this.$store.commit({
              type:'changeShowHide',
              showOrHide:status
            })
          }
      },
      store
    }
</script>
<style lang="scss" scoped="" type="text/css">
  @import 'headerBar.scss';


</style>
